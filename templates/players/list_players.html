{% extends "menu.html" %}

{% block title %}Liste des joueurs{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/global.css') }}">
<style>
    #search-input, #team-filter {
        padding: 6px 10px;
        width: 250px;
        border-radius: 6px;
        border: 1px solid #ccc;
        margin-bottom: 20px;
        margin-right: 10px;
    }
    .filter-container {
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }
</style>
{% endblock %}

{% block content %}

<div class="teams-header">
    <h2>Liste des joueurs</h2>
    <a href="{{ url_for('players.create_player') }}" class="btn-create">➕ Ajouter un joueur</a>
</div>

<!-- Filtres dynamiques -->
<div class="filter-container">
    <input type="text" id="search-input" placeholder="Rechercher par prénom ou nom...">
    <select id="team-filter">
        <option value="">Toutes les équipes</option>
        {% for team in teams %}
            <option value="{{ team.name }}">{{ team.name }}</option>
        {% endfor %}
    </select>
</div>

{% if players %}
<div class="teams-grid" id="players-grid">

    {% for player in players %}
    <div class="team-card" data-team="{{ player.team.name }}">
        <!-- Bouton suppression -->
        <form action="{{ url_for('players.delete_player', player_id=player.id) }}"
              method="post" class="delete-form"
              onsubmit="return confirm('Voulez-vous vraiment supprimer ce joueur ?');">
            <button type="submit" class="btn-delete">&times;</button>
        </form>

        <!-- Lien vers modification -->
        <a href="{{ url_for('players.edit_player', player_id=player.id) }}" class="team-link">

            {% if player.image_filename %}
                <img src="{{ url_for('static', filename='uploads/players/' ~ player.image_filename) }}"
                     alt="Photo joueur"
                     class="team-image"
                     style="width:100%; height:150px; object-fit:cover; border-radius:10px;">
            {% else %}
                <div class="team-image-placeholder"
                     style="width:100%; height:150px; background:#ecf0f1; border-radius:10px;
                            display:flex; align-items:center; justify-content:center;
                            color:#7f8c8d; font-size:14px;">
                    Pas d'image
                </div>
            {% endif %}

            <h3 class="player-name" style="margin-top:10px;">
                {{ player.first_name }} {{ player.last_name }}
            </h3>

            <p>Numéro : {{ player.number if player.number else 'Non défini' }}</p>
            <p>Équipe : {{ player.team.name }}</p>

        </a>
    </div>
    {% endfor %}

</div>

{% else %}
<p class="no-teams">Aucun joueur enregistré pour le moment.</p>
{% endif %}

<script>
    const searchInput = document.getElementById('search-input');
    const teamSelect = document.getElementById('team-filter');
    const cards = document.querySelectorAll('#players-grid .team-card');

    function filterCards() {
        const query = searchInput.value.toLowerCase();
        const selectedTeam = teamSelect.value;

        cards.forEach(card => {
            const nameEl = card.querySelector('.player-name');
            const name = nameEl.textContent.toLowerCase();
            const team = card.dataset.team;

            const matchesName = name.includes(query);
            const matchesTeam = !selectedTeam || team === selectedTeam;

            card.style.display = (matchesName && matchesTeam) ? '' : 'none';
        });
    }

    searchInput.addEventListener('input', filterCards);
    teamSelect.addEventListener('change', filterCards);
</script>

{% endblock %}
